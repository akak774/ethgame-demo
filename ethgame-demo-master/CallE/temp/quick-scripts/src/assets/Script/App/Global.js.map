{"version":3,"sources":["assets\\Script\\App\\Global.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { LocMsg } from \"../BaseModel/MsgEvent\";\nimport { DataBaseKey, SaveDataKey } from \"../BaseModel/Types\";\nimport DataManager from \"../Manager/DataManager\";\nimport { DefaultPlayerInfo, IPlayerInfo } from \"../Model/PlayerProp\";\nimport { DefaultShopInfo, IRobot } from \"../Model/RobotProp\";\nimport Utils from \"../Utils/Utils\";\nimport {DefaultEnergyInfo, IEnergy, MakeNewEnergy} from \"../Energy/EnergyProp\";\nimport {UpdateEnergy} from \"../Utils/LocalDataAPI\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Global extends cc.Component {\n\n    private static _inst: Global = null;\n    public static get Inst() {\n        return this._inst;\n    }\n\n    onLoad(): void {\n        Global._inst = this;\n        this._InitLocalData();\n    }\n    Emit(event: string | LocMsg, arg1?: any, arg2?: any, arg3?: any, arg4?: any, arg5?: any) {\n        this.node.emit(event.toString(), arg1, arg2, arg3, arg4, arg5);\n    }\n\n    On(event: string | LocMsg, callback: Function, target?: any, useCapture?: boolean) {\n        this.node.on(event.toString(), callback, target, useCapture);\n    }\n\n    Once(event: string | LocMsg, callback: Function, target?: any, useCapture?: boolean) {\n        this.node.once(event.toString(), callback, target, useCapture);\n    }\n\n    Off(event: string | LocMsg, callback?: Function, target?: any, useCapture?: boolean) {\n        this.node.off(event.toString(), callback, target, useCapture);\n    }\n\n    // update (dt) {}\n    private _InitLocalData() {\n\n        // 个人数据\n        let playerLoadData = Utils.LoadData(SaveDataKey.PLAYER_DATA);\n        if (!playerLoadData) {\n            let player = DefaultPlayerInfo();\n            DataManager.Inst.SetData<IPlayerInfo>(DataBaseKey.PLAYER_DATA, player);\n            Utils.SaveData(SaveDataKey.PLAYER_DATA, JSON.stringify(player))\n        } else {\n            let player = JSON.parse(playerLoadData) as IPlayerInfo;\n            DataManager.Inst.SetData<IPlayerInfo>(DataBaseKey.PLAYER_DATA, player);\n        }\n\n        // 商城数据\n        let shopLoadData = Utils.LoadData(SaveDataKey.SHOP_DATA);\n        if (!shopLoadData) {\n            let shops = DefaultShopInfo();\n            DataManager.Inst.SetData<IRobot[]>(DataBaseKey.SHOP_DATA, shops);\n            Utils.SaveData(SaveDataKey.SHOP_DATA, JSON.stringify(shops))\n        } else {\n            let shop = JSON.parse(shopLoadData) as IRobot[];\n            DataManager.Inst.SetData<IRobot[]>(DataBaseKey.SHOP_DATA, shop);\n        }\n\n        // energy data\n        Utils.RemoveSaveData(SaveDataKey.ENERGY_DATA);\n        let energyLoadData = Utils.LoadData(SaveDataKey.ENERGY_DATA);\n        if (!energyLoadData) {\n            let energy = DefaultEnergyInfo();\n            DataManager.Inst.SetData<IEnergy[]>(DataBaseKey.ENERGY_DATA, energy);\n            Utils.SaveData(SaveDataKey.ENERGY_DATA, JSON.stringify(energy))\n        } else {\n            let energy = JSON.parse(energyLoadData) as IEnergy[];\n            DataManager.Inst.SetData<IEnergy[]>(DataBaseKey.ENERGY_DATA, energy);\n        }\n        UpdateEnergy();\n    }\n}\n"]}